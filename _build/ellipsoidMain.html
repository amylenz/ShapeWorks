
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Full Example Pipeline for Statistical Shape Modeling with ShapeWorks &#8212; ShapeWorks 5.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="full-example-pipeline-for-statistical-shape-modeling-with-shapeworks">
<span id="example-ellipsoidmain"></span><h1>Full Example Pipeline for Statistical Shape Modeling with ShapeWorks<a class="headerlink" href="#full-example-pipeline-for-statistical-shape-modeling-with-shapeworks" title="Permalink to this headline">¶</a></h1>
<p>In this example we provide a full pipeline with an exple dataset of axis
aligned ellipsoids. We provide two different datasets for two different
senarios, prepared data consists of the binary images which do not require
alignment/resampling/cropping as pre-processing and only require conversion to
signed distance transforms before running the ShapeWorks particle based
optimization. Second is the unprepped data which requires additional
pre-processing steps before it can be fed into the optimization.</p>
<p>This example is set to serve as a test case for new ShapeWorks users, and each
step is explained in the shapeworks including the pre-processing, the
optimization and, the post ShapeWorks visualization.</p>
<p>First import the necessary modules</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">zipfile</span> <span class="k">import</span> <span class="n">ZipFile</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="kn">from</span> <span class="nn">GroomUtils</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">OptimizeUtils</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">AnalyzeUtils</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Example ShapeWorks Pipeline&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--interactive&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run in interactive mode&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--start_with_prepped_data&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Start with already prepped data&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--use_single_scale&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Single scale or multi scale optimization&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
</div>
<p>Unzip the data for this tutorial.</p>
<p>The data is inside the Ellipsoids.zip, run the following function to unzip the
data and create necessary supporting files. The files will be Extracted in a
newly created Directory TestEllipsoids.
This data both prepped and unprepped are binary images of ellipsoids varying
one of the axes while the other two are kept fixed.</p>
<p>Extract the zipfile into proper directory and create necessary supporting
files</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 1. Extract Data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">interactive</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press Enter to continue&quot;</span><span class="p">)</span>

<span class="n">parentDir</span><span class="o">=</span><span class="s2">&quot;TestEllipsoids/&quot;</span>
<span class="n">filename</span><span class="o">=</span><span class="s2">&quot;Ellipsoids.zip&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">parentDir</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">parentDir</span><span class="p">)</span>
<span class="c1"># extract the zipfile</span>
<span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipObj</span><span class="p">:</span>
      <span class="n">zipObj</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">parentDir</span><span class="p">)</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">start_with_prepped_data</span><span class="p">:</span>
              <span class="n">fileList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;TestEllipsoids/Ellipsoids_UnPrepped/*.nrrd&quot;</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
              <span class="n">fileList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;TestEllipsoids/Ellipsoids_Prepped/*.nrrd&quot;</span><span class="p">))</span>

<span class="n">fileList</span> <span class="o">=</span> <span class="n">fileList</span><span class="p">[:</span><span class="mi">15</span><span class="p">]</span>
</pre></div>
</div>
<p>Most of the following steps even though wrapped in python functions are using
the underlying c++ code, for which we need to call the source paths to the
binaries. This step should be common for any use of a function in ShapeWorks.
__This requires the full ShapeWorks to be correctly built/downloaded!__’</p>
<p>These following commands set the temporary environment variables to point to
shapeworks binaries and set the necessary library paths</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">binpath</span> <span class="o">=</span> <span class="s2">&quot;../build/shapeworks-build/binary&quot;</span>
<span class="n">installpath</span> <span class="o">=</span> <span class="s2">&quot;../install&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binpath</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">]</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LD_LIBRARY_PATH&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">installpath</span> <span class="o">+</span> <span class="s2">&quot;/lib:&quot;</span> <span class="o">+</span> <span class="n">installpath</span> <span class="o">+</span> <span class="s2">&quot;/lib64&quot;</span>
</pre></div>
</div>
<p>## GROOM : Data Pre-processing
For the unprepped data the first few steps are
– Isotropic resampling
– Padding
– Center of Mass Alignment
– Rigid Alignment
– Largest Bounding Box and Cropping</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 2. Groom - Data Pre-processing</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">interactive</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press Enter to continue&quot;</span><span class="p">)</span>

<span class="n">parentDir</span> <span class="o">=</span> <span class="s1">&#39;../TestEllipsoids/PrepOutput/&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">parentDir</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">parentDir</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">start_with_prepped_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Apply isotropic resampling</span>

<span class="sd">      For detailed explainations of parameters for resampling volumes, go to</span>
<span class="sd">      ... link</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="n">resampledFiles</span> <span class="o">=</span> <span class="n">applyIsotropicResampling</span><span class="p">(</span><span class="n">parentDir</span><span class="p">,</span> <span class="n">fileList</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Apply padding</span>

<span class="sd">      For detailed explainations of parameters for padding volumes, go to</span>
<span class="sd">      ... link</span>
<span class="sd">      &quot;&quot;&quot;</span>

      <span class="n">paddedFiles</span> <span class="o">=</span> <span class="n">applyPadding</span><span class="p">(</span><span class="n">parentDir</span><span class="p">,</span> <span class="n">resampledFiles</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Apply center of mass alignment</p>
<p>For detailed explainations of parameters for center of mass (COM) alignment of volumes, go to
… link</p>
<dl>
<dt>::</dt><dd><p>comFiles = applyCOMAlignment(parentDir, paddedFiles, paddedFiles)
“”“Apply rigid alignment”“”</p>
<p>rigidFiles = applyRigidAlignment(parentDir, comFiles, comFiles[0])</p>
<p>“”“Compute largest bounding box and apply cropping”“”
croppedFiles = applyCropping(parentDir, rigidFiles, rigidFiles)</p>
</dd>
</dl>
<p>We convert the scans to distance transforms, this step is common for both the
prepped as well as unprepped data, just provide correct filenames.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 3. Groom - Convert to distance transforms</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">interactive</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press Enter to continue&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">start_with_prepped_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">dtFiles</span> <span class="o">=</span> <span class="n">applyDistanceTransforms</span><span class="p">(</span><span class="n">parentDir</span><span class="p">,</span> <span class="n">croppedFiles</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
      <span class="n">dtFiles</span> <span class="o">=</span> <span class="n">applyDistanceTransforms</span><span class="p">(</span><span class="n">parentDir</span><span class="p">,</span> <span class="n">fileList</span><span class="p">)</span>
</pre></div>
</div>
<p>## OPTIMIZE : Particle Based Optimization</p>
<p>Now that we have the distance transform representation of data we create
the parameter files for the shapeworks particle optimization routine.
For more details on the plethora of parameters for shapeworks please refer to
…[link to documentation]</p>
<p>First we need to create a dictionary for all the parameters required by this
optimization routine</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 4. Optimize - Particle Based Optimization</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">interactive</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press Enter to continue&quot;</span><span class="p">)</span>

<span class="n">pointDir</span> <span class="o">=</span> <span class="s1">&#39;../TestEllipsoids/PointFiles/&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pointDir</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pointDir</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">use_single_scale</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">parameterDictionary</span> <span class="o">=</span> <span class="p">{</span>
              <span class="s2">&quot;number_of_particles&quot;</span> <span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
              <span class="s2">&quot;use_normals&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="s2">&quot;checkpointing_interval&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
              <span class="s2">&quot;keep_checkpoints&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="s2">&quot;iterations_per_split&quot;</span> <span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
              <span class="s2">&quot;optimization_iterations&quot;</span> <span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
              <span class="s2">&quot;starting_regularization&quot;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
              <span class="s2">&quot;ending_regularization&quot;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
              <span class="s2">&quot;recompute_regularization_interval&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s2">&quot;domains_per_shape&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">&quot;relative_weighting&quot;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
              <span class="s2">&quot;initial_relative_weighting&quot;</span> <span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
              <span class="s2">&quot;procrustes_interval&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="s2">&quot;procrustes_scaling&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="s2">&quot;save_init_splits&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="s2">&quot;debug_projection&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="s2">&quot;mesh_based_attributes&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="s2">&quot;verbosity&quot;</span> <span class="p">:</span> <span class="mi">3</span>
      <span class="p">}</span>
</pre></div>
</div>
<p>Now we execute a single scale particle optimization function.</p>
<dl>
<dt>::</dt><dd><blockquote>
<div><p>[localPointFiles, worldPointFiles] = runShapeWorksOptimize_Basic(pointDir, dtFiles, parameterDictionary)</p>
</div></blockquote>
<dl>
<dt>else:</dt><dd><dl class="simple">
<dt>parameterDictionary = {</dt><dd><p>“starting_particles” : 32,
“number_of_levels” : 3,
“use_normals”: 0,
“checkpointing_interval” : 200,
“keep_checkpoints” : 0,
“iterations_per_split” : 1000,
“optimization_iterations” : 2000,
“starting_regularization” : 100,
“ending_regularization” : 0.1,
“recompute_regularization_interval” : 2,
“domains_per_shape” : 1,
“relative_weighting” : 10,
“initial_relative_weighting” : 0.01,
“procrustes_interval” : 0,
“procrustes_scaling” : 0,
“save_init_splits” : 0,
“debug_projection” : 0,
“mesh_based_attributes” : 0,
“verbosity” : 3</p>
</dd>
</dl>
<p>}</p>
<p>“””
Now we execute a multi-scale particle optimization function.
“””
[localPointFiles, worldPointFiles] = runShapeWorksOptimize_MultiScale(pointDir, dtFiles, parameterDictionary)</p>
</dd>
</dl>
</dd>
</dl>
<p>## ANALYZE : Shape Analysis and Visualization</p>
<p>Shapeworks yields relatively sparse correspondence models that may be inadequate to reconstruct
thin structures and high curvature regions of the underlying anatomical surfaces.
However, for many applications, we require a denser correspondence model, for example,
to construct better surface meshes, make more detailed measurements, or conduct biomechanical
or other simulations on mesh surfaces. One option for denser modeling is
to increase the number of particles per shape sample. However, this approach necessarily
increases the computational overhead, especially when modeling large clinical cohorts.</p>
<p>Here we adopt a template-deformation approach to establish an inter-sample dense surface correspondence,
given a sparse set of optimized particles. To avoid introducing bias due to the template choice, we developed
an unbiased framework for template mesh construction. The dense template mesh is then constructed
by triangulating the isosurface of the mean distance transform. This unbiased strategy will preserve
the topology of the desired anatomy  by taking into account the shape population of interest.
In order to recover a sample-specific surface mesh, a warping function is constructed using the
sample-level particle system and the mean/template particle system as control points.
This warping function is then used to deform the template dense mesh to the sample space.</p>
<p>Reconstruct the dense mean surface given the sparse correspondence model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 5. Analysis - Reconstruct the dense mean surface given the sparse correspodence model.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">interactive</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press Enter to continue&quot;</span><span class="p">)</span>

<span class="n">meanDir</span>   <span class="o">=</span> <span class="s1">&#39;../TestEllipsoids/MeanReconstruction/&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">meanDir</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">meanDir</span><span class="p">)</span>
</pre></div>
</div>
<p>Parameter dictionary for ReconstructMeanSurface cmd tool.</p>
<dl>
<dt>::</dt><dd><dl>
<dt>parameterDictionary = {</dt><dd><blockquote>
<div><p>“number_of_particles” : 128,
“out_prefix” : meanDir + ‘ellipsoid’,
“do_procrustes” : 0,
“do_procrustes_scaling” : 0,
“levelsetValue” : 0.0,</p>
</div></blockquote>
<p>“targetReduction” : 0.0,
“featureAngle” : 30,
“lsSmootherIterations” : 1,
“meshSmootherIterations” : 1,
“preserveTopology” : 1,
“qcFixWinding” : 1,
“qcDoLaplacianSmoothingBeforeDecimation” : 1,
“qcDoLaplacianSmoothingAfterDecimation” : 1,
“qcSmoothingLambda” : 0.5,
“qcSmoothingIterations” : 3,
“qcDecimationPercentage” : 0.9,
“normalAngle” : 90,
“use_tps_transform” : 0,
“use_bspline_interpolation” : 0,
“display” : 0,
“glyph_radius” : 1</p>
</dd>
</dl>
<p>}</p>
<p>runReconstructMeanSurface(dtFiles, localPointFiles, worldPointFiles, parameterDictionary)</p>
</dd>
</dl>
<p>Reconstruct the dense sample-specfic surface in the local coordinate system given the dense mean surface</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 6. Analysis - Reconstruct sample-specific dense surface in the local coordinate system.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">interactive</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press Enter to continue&quot;</span><span class="p">)</span>

<span class="n">meshDir_local</span>   <span class="o">=</span> <span class="s1">&#39;../TestEllipsoids/MeshFiles-Local/&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">meshDir_local</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">meshDir_local</span><span class="p">)</span>
</pre></div>
</div>
<p>Parameter dictionary for ReconstructSurface cmd tool.</p>
<dl>
<dt>::</dt><dd><dl class="simple">
<dt>parameterDictionary = {</dt><dd><p>“number_of_particles” : 128,
“mean_prefix” : meanDir + ‘ellipsoid’,
“out_prefix” : meshDir_local + ‘ellipsoid’,
“use_tps_transform” : 0,
“use_bspline_interpolation” : 0,
“display” : 0,
“glyph_radius” : 1</p>
</dd>
</dl>
<p>}</p>
<p>localDensePointFiles = runReconstructSurface(localPointFiles, parameterDictionary)</p>
</dd>
</dl>
<p>Reconstruct the dense sample-specfic surface in the world coordinate system given the dense mean surface</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 7. Analysis - Reconstruct sample-specific dense surface in the world coordinate system.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">interactive</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press Enter to continue&quot;</span><span class="p">)</span>

<span class="n">meshDir_global</span>   <span class="o">=</span> <span class="s1">&#39;../TestEllipsoids/MeshFiles-World/&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">meshDir_global</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">meshDir_global</span><span class="p">)</span>
</pre></div>
</div>
<p>Parameter dictionary for ReconstructSurface cmd tool.</p>
<dl>
<dt>::</dt><dd><dl class="simple">
<dt>parameterDictionary = {</dt><dd><p>“number_of_particles” : 128,
“mean_prefix” : meanDir + ‘ellipsoid’,
“out_prefix” : meshDir_global + ‘ellipsoid’,
“use_tps_transform” : 0,
“use_bspline_interpolation” : 0,
“display” : 0,
“glyph_radius” : 1</p>
</dd>
</dl>
<p>}</p>
<p>worldDensePointFiles = runReconstructSurface(worldPointFiles, parameterDictionary)</p>
</dd>
</dl>
<p>Reconstruct dense meshes along dominant pca modes</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 8. Analysis - Reconstruct dense surface for samples along dominant PCA modes.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">interactive</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press Enter to continue&quot;</span><span class="p">)</span>

<span class="n">pcaDir</span>   <span class="o">=</span> <span class="s1">&#39;../TestEllipsoids/PCAModesFiles/&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pcaDir</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pcaDir</span><span class="p">)</span>
</pre></div>
</div>
<p>Parameter dictionary for ReconstructSamplesAlongPCAModes cmd tool.</p>
<dl>
<dt>::</dt><dd><dl class="simple">
<dt>parameterDictionary = {</dt><dd><p>“number_of_particles” : 128,
“mean_prefix” : meanDir + ‘ellipsoid’,
“out_prefix” : pcaDir + ‘ellipsoid’,
“use_tps_transform” : 0,
“use_bspline_interpolation” : 0,
“display” : 0,
“glyph_radius” : 1,
“maximum_variance_captured” : 0.95,
“maximum_std_dev” : 2,
“number_of_samples_per_mode” : 10</p>
</dd>
</dl>
<p>}</p>
<p>runReconstructSamplesAlongPCAModes(worldPointFiles, parameterDictionary)</p>
</dd>
</dl>
<p>The local and world particles will be saved in TestEllipsoids/PointFiles/128
directory, the set of these points on each shape constitue a particle based shape model
or a Point Distribution Model (PDM). This PDM shape representation is
computationally flexible and efficient and we can use it to perform shape
analysis. Here we provide one of the provided visualization tool in the
shapeworks codebase : ShapeWorksView2.
This tool will showcase individual shapes with their particle representations,
as well as the PCA model constructed using these point correspondences. The
PCA modes of variation representing the given shape population can be
visualized.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 9. Analysis - Launch ShapeWorksView2 - sparse correspondence model.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">interactive</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press Enter to continue&quot;</span><span class="p">)</span>

<span class="n">launchShapeWorksView2</span><span class="p">(</span><span class="n">pointDir</span><span class="p">,</span> <span class="n">worldPointFiles</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 10. Analysis - Launch ShapeWorksView2 - dense correspondence model.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press Enter to continue&quot;</span><span class="p">)</span>

<span class="n">launchShapeWorksView2</span><span class="p">(</span><span class="n">meshDir_global</span><span class="p">,</span> <span class="n">worldDensePointFiles</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Shapeworks Pipeline Complete!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-example-source-code admonition">
<p class="admonition-title">Example source code</p>
<p>You can download <a class="reference download internal" download="" href="_downloads/9fc9640e32737f6da2c68c8ebeb58063/ellipsoidMain.py"><code class="xref download docutils literal notranslate"><span class="pre">the</span> <span class="pre">full</span> <span class="pre">source</span> <span class="pre">code</span> <span class="pre">of</span> <span class="pre">this</span> <span class="pre">example</span></code></a>. This same script is also included in the ShapeWorks source distribution under the <code class="file docutils literal notranslate"><span class="pre">UseCaseDocumentation/</span></code> directory.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">ShapeWorks</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html#indices-and-tables">Indices and tables</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, SCI Institute.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="_sources/ellipsoidMain.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>